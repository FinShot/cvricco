const q=window.location.hostname!=="localhost",v=q?"wss://cvricco.onrender.com/ws":"ws://localhost:8000/ws",d=`${v}/${Math.random().toString(36).substring(7)}`;console.log("WebSocket URL:",d);let n=null;document.addEventListener("DOMContentLoaded",()=>{const o=document.querySelector(".chatbot-container"),g=o?.querySelector(".chat-toggle"),y=o?.querySelector(".close-chat"),i=o?.querySelector(".chat-window"),c=o?.querySelector("input"),p=o?.querySelector(".send-message"),a=o?.querySelector(".chat-messages");if(!o||!g||!y||!i||!c||!p||!a){console.error("Required chat elements not found");return}function m(){if(!n)try{console.log("Attempting to connect to WebSocket:",d),n=new WebSocket(d),n.onopen=()=>{console.log("WebSocket connected successfully!")},n.onmessage=t=>{if(t.data==="typing"){const s=document.createElement("div");s.className="message bot typing-message",s.innerHTML='<div class="message-content">Ricco is typing...</div>',a.appendChild(s),a.scrollTop=a.scrollHeight}else{const s=a.querySelector(".typing-message");s&&s.remove(),r(t.data,!1)}},n.onerror=t=>{console.error("WebSocket error:",t),r("Error connecting to chat server. Please try again.",!1)},n.onclose=()=>{console.log("WebSocket disconnected"),n=null,/Mobi|Android/i.test(navigator.userAgent)&&!n&&setTimeout(m,1e3)}}catch(t){console.error("Error creating WebSocket:",t),r("Failed to create WebSocket connection",!1)}}function f(){i?.classList.toggle("hidden"),i?.classList.contains("hidden")||(m(),c?.focus())}function r(t,s=!1){const l=document.querySelector(".chat-messages"),h=document.querySelector("#message-template");if(!l||!h)return;const b=l.querySelector(".typing-message");b&&b.remove();const u=h.content.cloneNode(!0),k=u.querySelector(".message"),P=u.querySelector(".message-content");k&&P&&(k.classList.add(s?"user":"bot"),P.textContent=t,l.appendChild(u),l.scrollTop=l.scrollHeight)}function S(){const t=c.value.trim();t&&(console.log("Sending message:",t),r(t,!0),n?.readyState===WebSocket.OPEN?n.send(t):(console.error("WebSocket is not connected"),r("Error: Not connected to server",!1)),c.value="")}g?.addEventListener("click",f),y?.addEventListener("click",f),p.addEventListener("click",t=>{t.preventDefault(),S()}),c.addEventListener("keypress",t=>{t.key==="Enter"&&(t.preventDefault(),S())})});const e={button:document.querySelector(".play-button"),nextButton:document.querySelector(".next-button"),audio:document.querySelector("#audio-player"),playIcon:document.querySelector(".play-icon"),pauseIcon:document.querySelector(".pause-icon"),titleEl:document.querySelector(".song-title"),artistEl:document.querySelector(".song-artist"),currentTrack:0,isPlaying:!1,playlist:[{title:"Space Beats",artist:"Pixabay music",url:"https://cdn.pixabay.com/download/audio/2022/11/22/audio_febc508520.mp3"},{title:"Lofi Study",artist:"Pixabay music",url:"https://cdn.pixabay.com/download/audio/2022/05/27/audio_1808fbf07a.mp3"}],updatePlayPauseIcons(o){this.playIcon&&this.pauseIcon&&(this.playIcon.classList.toggle("hidden",o),this.pauseIcon.classList.toggle("hidden",!o))}};e.button&&e.audio&&e.playIcon&&e.pauseIcon&&(e.audio.addEventListener("play",()=>{e.isPlaying=!0,e.updatePlayPauseIcons(!0)}),e.audio.addEventListener("pause",()=>{e.isPlaying=!1,e.updatePlayPauseIcons(!1)}),e.button.addEventListener("click",()=>{e.audio.paused?(e.audio.play(),e.isPlaying=!0,e.updatePlayPauseIcons(!0)):(e.audio.pause(),e.isPlaying=!1,e.updatePlayPauseIcons(!1))}),e.nextButton?.addEventListener("click",()=>{e.currentTrack=(e.currentTrack+1)%e.playlist.length;const o=e.playlist[e.currentTrack];e.audio.src=o.url,e.titleEl.textContent=o.title,e.artistEl.textContent=o.artist,e.isPlaying=!1,e.updatePlayPauseIcons(!1),e.audio.pause()}));
