const q=window.location.hostname!=="localhost",E=q?"wss://cvricco.onrender.com/ws":"ws://localhost:8000/ws",g=`${E}/${Math.random().toString(36).substring(7)}`;console.log("WebSocket URL:",g);let n=null;document.addEventListener("DOMContentLoaded",()=>{const o=document.querySelector(".chatbot-container"),p=o?.querySelector(".chat-toggle"),y=o?.querySelector(".close-chat"),l=o?.querySelector(".chat-window"),c=o?.querySelector("input"),m=o?.querySelector(".send-message"),r=o?.querySelector(".chat-messages");if(!o||!p||!y||!l||!c||!m||!r){console.error("Required chat elements not found");return}function f(){if(!n)try{console.log("Attempting to connect to WebSocket:",g),n=new WebSocket(g),n.onopen=()=>{console.log("WebSocket connected successfully!")},n.onmessage=t=>{if(t.data==="typing"){const s=document.createElement("div");s.className="message bot typing-message",s.innerHTML='<div class="message-content">Ricco is typing...</div>',r.appendChild(s),r.scrollTop=r.scrollHeight}else{const s=r.querySelector(".typing-message");s&&s.remove(),i(t.data,!1)}},n.onerror=t=>{console.error("WebSocket error:",t),i("Error connecting to chat server. Please try again.",!1)},n.onclose=()=>{console.log("WebSocket disconnected"),n=null,/Mobi|Android/i.test(navigator.userAgent)&&!n&&setTimeout(f,1e3)}}catch(t){console.error("Error creating WebSocket:",t),i("Failed to create WebSocket connection",!1)}}function S(){l?.classList.toggle("hidden"),l?.classList.contains("hidden")||(f(),c?.focus())}function i(t,s=!1){const a=document.querySelector(".chat-messages"),b=document.querySelector("#message-template");if(!a||!b)return;if(t==="typing"){const u=document.createElement("div");u.className="message bot typing-indicator",u.innerHTML=`
        <div class="message-content">
          <span class="dot"></span>
          <span class="dot"></span>
          <span class="dot"></span>
        </div>
      `,a.appendChild(u),a.scrollTop=a.scrollHeight;return}const v=a.querySelector(".typing-indicator");v&&v.remove();const d=b.content.cloneNode(!0),k=d.querySelector(".message"),P=d.querySelector(".message-content");k&&P&&(k.classList.add(s?"user":"bot"),P.textContent=t,a.appendChild(d),a.scrollTop=a.scrollHeight)}function h(){const t=c.value.trim();t&&(console.log("Sending message:",t),i(t,!0),n?.readyState===WebSocket.OPEN?n.send(t):(console.error("WebSocket is not connected"),i("Error: Not connected to server",!1)),c.value="")}p?.addEventListener("click",S),y?.addEventListener("click",S),m.addEventListener("click",t=>{t.preventDefault(),h()}),c.addEventListener("keypress",t=>{t.key==="Enter"&&(t.preventDefault(),h())})});const e={button:document.querySelector(".play-button"),nextButton:document.querySelector(".next-button"),audio:document.querySelector("#audio-player"),playIcon:document.querySelector(".play-icon"),pauseIcon:document.querySelector(".pause-icon"),titleEl:document.querySelector(".song-title"),artistEl:document.querySelector(".song-artist"),currentTrack:0,isPlaying:!1,playlist:[{title:"Space Beats",artist:"Pixabay music",url:"https://cdn.pixabay.com/download/audio/2022/11/22/audio_febc508520.mp3"},{title:"Lofi Study",artist:"Pixabay music",url:"https://cdn.pixabay.com/download/audio/2022/05/27/audio_1808fbf07a.mp3"}],updatePlayPauseIcons(o){this.playIcon&&this.pauseIcon&&(this.playIcon.classList.toggle("hidden",o),this.pauseIcon.classList.toggle("hidden",!o))}};e.button&&e.audio&&e.playIcon&&e.pauseIcon&&(e.audio.addEventListener("play",()=>{e.isPlaying=!0,e.updatePlayPauseIcons(!0)}),e.audio.addEventListener("pause",()=>{e.isPlaying=!1,e.updatePlayPauseIcons(!1)}),e.button.addEventListener("click",()=>{e.audio.paused?(e.audio.play(),e.isPlaying=!0,e.updatePlayPauseIcons(!0)):(e.audio.pause(),e.isPlaying=!1,e.updatePlayPauseIcons(!1))}),e.nextButton?.addEventListener("click",()=>{e.currentTrack=(e.currentTrack+1)%e.playlist.length;const o=e.playlist[e.currentTrack];e.audio.src=o.url,e.titleEl.textContent=o.title,e.artistEl.textContent=o.artist,e.isPlaying=!1,e.updatePlayPauseIcons(!1),e.audio.pause()}));
