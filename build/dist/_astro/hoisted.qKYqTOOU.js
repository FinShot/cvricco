const P=window.location.hostname!=="localhost",E=P?"wss://cvricco.onrender.com/ws":"ws://localhost:8000/ws",y=`${E}/${Math.random().toString(36).substring(7)}`;console.log("WebSocket URL:",y);let n=null;document.addEventListener("DOMContentLoaded",()=>{const o=document.querySelector(".chatbot-container"),m=o?.querySelector(".chat-toggle"),p=o?.querySelector(".close-chat"),g=o?.querySelector(".chat-window"),i=o?.querySelector("input"),f=o?.querySelector(".send-message"),a=o?.querySelector(".chat-messages");if(!o||!m||!p||!g||!i||!f||!a){console.error("Required chat elements not found");return}function S(){if(!n)try{console.log("Attempting to connect to WebSocket:",y),n=new WebSocket(y),n.onopen=()=>{console.log("WebSocket connected successfully!")},n.onmessage=t=>{if(t.data==="typing"){const c=a.querySelector(".typing-message");c&&c.remove();const s=document.querySelector("#message-template");if(s){const r=s.content.cloneNode(!0),d=r.querySelector(".message"),l=r.querySelector(".message-content");d&&l&&(d.classList.add("bot","typing-message"),l.textContent="Ricco is typing...",a.appendChild(r),a.scrollTop=a.scrollHeight)}}else{const c=a.querySelector(".typing-message");c&&c.remove(),u(t.data,!1)}},n.onerror=t=>{console.error("WebSocket error:",t),u("Error connecting to chat server. Please try again.",!1)},n.onclose=()=>{console.log("WebSocket disconnected"),n=null,/Mobi|Android/i.test(navigator.userAgent)&&!n&&setTimeout(S,1e3)}}catch(t){console.error("Error creating WebSocket:",t),u("Failed to create WebSocket connection",!1)}}function h(){g?.classList.toggle("hidden"),g?.classList.contains("hidden")||(S(),i?.focus())}function u(t,c=!1){const s=document.querySelector(".chat-messages"),r=document.querySelector("#message-template");if(!s||!r)return;const d=s.querySelector(".typing-message");d&&d.remove();const l=r.content.cloneNode(!0),q=l.querySelector(".message"),k=l.querySelector(".message-content");q&&k&&(q.classList.add(c?"user":"bot"),k.textContent=t,s.appendChild(l),s.scrollTop=s.scrollHeight)}function b(){const t=i.value.trim();t&&(console.log("Sending message:",t),u(t,!0),n?.readyState===WebSocket.OPEN?n.send(t):(console.error("WebSocket is not connected"),u("Error: Not connected to server",!1)),i.value="")}m?.addEventListener("click",h),p?.addEventListener("click",h),f.addEventListener("click",t=>{t.preventDefault(),b()}),i.addEventListener("keypress",t=>{t.key==="Enter"&&(t.preventDefault(),b())})});const e={button:document.querySelector(".play-button"),nextButton:document.querySelector(".next-button"),audio:document.querySelector("#audio-player"),playIcon:document.querySelector(".play-icon"),pauseIcon:document.querySelector(".pause-icon"),titleEl:document.querySelector(".song-title"),artistEl:document.querySelector(".song-artist"),currentTrack:0,isPlaying:!1,playlist:[{title:"Space Beats",artist:"Pixabay music",url:"https://cdn.pixabay.com/download/audio/2022/11/22/audio_febc508520.mp3"},{title:"Lofi Study",artist:"Pixabay music",url:"https://cdn.pixabay.com/download/audio/2022/05/27/audio_1808fbf07a.mp3"}],updatePlayPauseIcons(o){this.playIcon&&this.pauseIcon&&(this.playIcon.classList.toggle("hidden",o),this.pauseIcon.classList.toggle("hidden",!o))}};e.button&&e.audio&&e.playIcon&&e.pauseIcon&&(e.audio.addEventListener("play",()=>{e.isPlaying=!0,e.updatePlayPauseIcons(!0)}),e.audio.addEventListener("pause",()=>{e.isPlaying=!1,e.updatePlayPauseIcons(!1)}),e.button.addEventListener("click",()=>{e.audio.paused?(e.audio.play(),e.isPlaying=!0,e.updatePlayPauseIcons(!0)):(e.audio.pause(),e.isPlaying=!1,e.updatePlayPauseIcons(!1))}),e.nextButton?.addEventListener("click",()=>{e.currentTrack=(e.currentTrack+1)%e.playlist.length;const o=e.playlist[e.currentTrack];e.audio.src=o.url,e.titleEl.textContent=o.title,e.artistEl.textContent=o.artist,e.isPlaying=!1,e.updatePlayPauseIcons(!1),e.audio.pause()}));
